!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.client=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(b,c,d){!function(b){"use strict";function e(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1}b.version="1.0.0";var f=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,g=/,/,h=/^\s*(_?)(\S+?)\1\s*$/,i=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;b.errors={MAPPING_BAD_PROP:"[Error infuse.Injector.mapClass/mapValue] the first parameter is invalid, a string is expected",MAPPING_BAD_VALUE:"[Error infuse.Injector.mapClass/mapValue] the second parameter is invalid, it can't null or undefined, with property: ",MAPPING_BAD_CLASS:"[Error infuse.Injector.mapClass/mapValue] the second parameter is invalid, a function is expected, with property: ",MAPPING_BAD_SINGLETON:"[Error infuse.Injector.mapClass] the third parameter is invalid, a boolean is expected, with property: ",MAPPING_ALREADY_EXISTS:"[Error infuse.Injector.mapClass/mapValue] this mapping already exists, with property: ",CREATE_INSTANCE_INVALID_PARAM:"[Error infuse.Injector.createInstance] invalid parameter, a function is expected",NO_MAPPING_FOUND:"[Error infuse.Injector.getInstance] no mapping found",INJECT_INSTANCE_IN_ITSELF_PROPERTY:"[Error infuse.Injector.getInjectedValue] A matching property has been found in the target, you can't inject an instance in itself",INJECT_INSTANCE_IN_ITSELF_CONSTRUCTOR:"[Error infuse.Injector.getInjectedValue] A matching constructor parameter has been found in the target, you can't inject an instance in itself",DEPENDENCIES_MISSING_IN_STRICT_MODE:'[Error infuse.Injector.getDependencies] An "inject" property (array) that describes the dependencies is missing in strict mode.'};var j=function(a,b,c,d){this.prop=a,this.value=b,this.cl=c,this.singleton=d||!1},k=function(a){if("string"!=typeof a)throw new Error(b.errors.MAPPING_BAD_PROP)},l=function(a,c){if(void 0===c||null===c)throw new Error(b.errors.MAPPING_BAD_VALUE+a)},m=function(a,c){if("function"!=typeof c)throw new Error(b.errors.MAPPING_BAD_CLASS+a)},n=function(a,c){if("boolean"!=typeof c)throw new Error(b.errors.MAPPING_BAD_SINGLETON+a)},o=function(a,c){var d=b.getDependencies(c);if(e(d,a))throw new Error(b.errors.INJECT_INSTANCE_IN_ITSELF_CONSTRUCTOR)},p=function(a,c){if(c.hasOwnProperty(a))throw new Error(b.errors.INJECT_INSTANCE_IN_ITSELF_PROPERTY)};b.Injector=function(){this.mappings={},this.parent=null,this.strictMode=!1},b.getDependencies=function(a){function b(a,b,c){d.push(c)}var c,d=[];a.hasOwnProperty("inject")&&"[object Array]"===Object.prototype.toString.call(a.inject)&&a.inject.length>0&&(c=a.inject);for(var e=a.toString().replace(i,""),j=e.match(f),k=j[1].split(g),l=0,m=k.length;m>l;l++){var n=c&&c[l]?c[l]:k[l];n.replace(h,b)}return d},b.Injector.prototype={createChild:function(){var a=new b.Injector;return a.parent=this,a.strictMode=this.strictMode,a},getMappingVo:function(a){return this.mappings?this.mappings[a]?this.mappings[a]:this.parent?this.parent.getMappingVo(a):null:null},mapValue:function(a,c){if(this.mappings[a])throw new Error(b.errors.MAPPING_ALREADY_EXISTS+a);return k(a),l(a,c),this.mappings[a]=new j(a,c,void 0,void 0),this},mapClass:function(a,c,d){if(this.mappings[a])throw new Error(b.errors.MAPPING_ALREADY_EXISTS+a);return k(a),m(a,c),d&&n(a,d),this.mappings[a]=new j(a,null,c,d),this},removeMapping:function(a){return this.mappings[a]=null,delete this.mappings[a],this},hasMapping:function(a){return!!this.mappings[a]},hasInheritedMapping:function(a){return!!this.getMappingVo(a)},getMapping:function(a){for(var b in this.mappings)if(this.mappings.hasOwnProperty(b)){var c=this.mappings[b];if(c.value===a||c.cl===a)return c.prop}},getValue:function(a){var c=this.mappings[a];if(!c){if(!this.parent)throw new Error(b.errors.NO_MAPPING_FOUND);c=this.parent.getMappingVo.apply(this.parent,arguments)}if(c.cl){var d=Array.prototype.slice.call(arguments);return d[0]=c.cl,c.singleton?(c.value||(c.value=this.createInstance.apply(this,d)),c.value):this.createInstance.apply(this,d)}return c.value},getClass:function(a){var b=this.mappings[a];if(!b){if(!this.parent)return;b=this.parent.getMappingVo.apply(this.parent,arguments)}return b.cl?b.cl:void 0},instantiate:function(a){if("function"!=typeof a)throw new Error(b.errors.CREATE_INSTANCE_INVALID_PARAM);if(this.strictMode&&!a.hasOwnProperty("inject"))throw new Error(b.errors.DEPENDENCIES_MISSING_IN_STRICT_MODE);for(var c=[null],d=b.getDependencies(a),e=0,f=d.length;f>e;e++)if(arguments.length>e+1&&void 0!==arguments[e+1]&&null!==arguments[e+1])c.push(arguments[e+1]);else{var g=d[e],h=this.getMappingVo(g);if(h){var i=this.getInjectedValue(h,g);c.push(i)}else c.push(void 0)}return new(Function.prototype.bind.apply(a,c))},inject:function(a,b){this.parent&&this.parent.inject(a,!0);for(var c in this.mappings)if(this.mappings.hasOwnProperty(c)){var d=this.getMappingVo(c);(a.hasOwnProperty(d.prop)||a.constructor&&a.constructor.prototype&&a.constructor.prototype.hasOwnProperty(d.prop))&&(a[c]=this.getInjectedValue(d,c))}return"function"!=typeof a.postConstruct||b||a.postConstruct(),this},getInjectedValue:function(a,b){var c,d=a.value;return a.cl&&(a.singleton?(a.value||(o(b,a.cl),a.value=this.instantiate(a.cl),c=a.value),d=a.value):(o(b,a.cl),d=this.instantiate(a.cl),c=d)),c&&(p(b,c),this.inject(c)),d},createInstance:function(){var a=this.instantiate.apply(this,arguments);return this.inject(a),a},getValueFromClass:function(a){for(var c in this.mappings)if(this.mappings.hasOwnProperty(c)){var d=this.mappings[c];if(d.cl===a)return d.singleton?(d.value||(d.value=this.createInstance.apply(this,arguments)),d.value):this.createInstance.apply(this,arguments)}if(this.parent)return this.parent.getValueFromClass.apply(this.parent,arguments);throw new Error(b.errors.NO_MAPPING_FOUND)},dispose:function(){this.mappings={}}},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new Error("Error, you must bind a function.");var c=Array.prototype.slice.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(Array.prototype.slice.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(Array.prototype.slice.call(arguments)))};return d}),"function"==typeof a&&"undefined"!=typeof a.amd&&a("infuse",b),"undefined"!=typeof c&&"undefined"!=typeof c.exports&&(c.exports=b),"undefined"!=typeof d&&(d=b)}(this.infuse=this.infuse||{})},{}],2:[function(a,b,c){"use strict";function d(){}ko.options.deferUpdates=!0,d.prototype.postConstruct=function(){this.mainSections=ko.observableArray(["project","map"]),this.selectedMainSection=ko.observable("project")},b.exports=d},{}],3:[function(a,b,c){"use strict";var d=function(a){window.setTimeout(a,0)};b.exports=d},{}],4:[function(a,b,c){"use strict";var d={};d.getResource=function(a,b,c){var d={method:"GET",url:a,dataType:"json",jsonp:!1,success:b,error:c};$.ajax(d)},d.putResource=function(a,b,c,d){var e={method:"PUT",url:a,dataType:"json",contentType:"application/json",data:JSON.stringify(b),jsonp:!1,processData:!1,success:c,error:d};$.ajax(e)},b.exports=d},{}],5:[function(a,b,c){"use strict";function d(){this.vm=null,this.projectsAdapter=null,this.levelsAdapter=null,this.mapAdapter=null}var e=a("infuse.js"),f=new e.Injector;f.mapValue("rest",a("./browser/rest.js")),f.mapValue("sys",{defer:a("./browser/defer.js")}),f.mapClass("vm",a("./ViewModel.js"),!0),f.mapClass("projectsAdapter",a("./vmAdapter/ProjectsAdapter"),!0),f.mapClass("levelsAdapter",a("./vmAdapter/LevelsAdapter"),!0),f.mapClass("mapAdapter",a("./vmAdapter/MapAdapter"),!0),d.prototype.postConstruct=function(){ko.applyBindings(this.vm)},f.mapClass("app",d,!0),b.exports={Application:d,injector:f,buildAndRun:function(){return f.getValue("app")}}},{"./ViewModel.js":2,"./browser/defer.js":3,"./browser/rest.js":4,"./vmAdapter/LevelsAdapter":7,"./vmAdapter/MapAdapter":8,"./vmAdapter/ProjectsAdapter":9,"infuse.js":1}],6:[function(a,b,c){"use strict";var d={};d.withResetValue=function(a){var b=!0,c=a,d={add:function(d){b?(c=d,b=!1):c!==d&&(c=a)},get:function(){return c}};return d},b.exports=d},{}],7:[function(a,b,c){"use strict";function d(){this.projectsAdapter=null,this.vm=null,this.rest=null}d.prototype.postConstruct=function(){var a=this.rest,b={available:ko.observableArray()};this.vm.levels=b,this.vm.projects.selected.subscribe(function(c){c?a.getResource(c.href+"/archive/levels",function(a){b.available(a.items)},function(){}):b.available([])})},b.exports=d},{}],8:[function(a,b,c){"use strict";function d(){this.projectsAdapter=null,this.vm=null,this.rest=null,this.sys=null}function e(a){var b=a.map(function(a){return a.toString(16)}).map(function(a){var b="0"+a;return b.substr(b.length-2)}).join(", 0x");return b.length>0&&(b="0x"+b),"["+b+"]"}var f=a("../../util/unifier.js"),g=function(a,b){a.tileType(b.properties.type),a.floorHeight(b.properties.floorHeight),a.ceilingHeight(b.properties.ceilingHeight),a.slopeHeight(b.properties.slopeHeight),a.northWallHeight(b.properties.calculatedWallHeights.north),a.eastWallHeight(b.properties.calculatedWallHeights.east),a.southWallHeight(b.properties.calculatedWallHeights.south),a.westWallHeight(b.properties.calculatedWallHeights.west),a.floorTextureIndex(b.properties.realWorld.floorTexture),a.floorTextureRotations(b.properties.realWorld.floorTextureRotations),a.ceilingTextureIndex(b.properties.realWorld.ceilingTexture),a.ceilingTextureRotations(b.properties.realWorld.ceilingTextureRotations),a.wallTextureIndex(b.properties.realWorld.wallTexture)};d.prototype.postConstruct=function(){var a=this.rest,b={tileTypes:["","open","solid","diagonalOpenSouthEast","diagonalOpenSouthWest","diagonalOpenNorthWest","diagonalOpenNorthEast","slopeSouthToNorth","slopeWestToEast","slopeNorthToSouth","slopeEastToWest","valleySouthEastToNorthWest","valleySouthWestToNorthEast","valleyNorthWestToSouthEast","valleyNorthEastToSouthWest","ridgeNorthWestToSouthEast","ridgeNorthEastToSouthWest","ridgeSouthEastToNorthWest","ridgeSouthWestToNorthEast"],selectedLevel:ko.observable(),levelTextures:ko.observableArray(),levelTextureUrls:ko.observableArray(),levelObjects:ko.observableArray(),sizeX:ko.observable(0),sizeY:ko.observable(0),tileRows:ko.observableArray(),textureDisplay:ko.observableArray(["Floor","Ceiling"]),selectedTextureDisplay:ko.observable("Floor"),selectedTiles:ko.observableArray(),selectedTileType:ko.observable(""),selectedTileFloorTextureIndex:ko.observable(-1),selectedTileCeilingTextureIndex:ko.observable(-1),selectedTileWallTextureIndex:ko.observable(-1)};this.vm.map=b,b.onTileClicked=this.getTileClickedHandler(),b.shouldShowFloorTexture=ko.computed(function(){return"Floor"===b.selectedTextureDisplay()}),b.shouldShowCeilingTexture=ko.computed(function(){return"Ceiling"===b.selectedTextureDisplay()}),b.selectedTileFloorTextureUrl=ko.computed(this.computeTextureUrl(b.selectedTileFloorTextureIndex)),b.selectedTileCeilingTextureUrl=ko.computed(this.computeTextureUrl(b.selectedTileCeilingTextureIndex)),b.selectedTileWallTextureUrl=ko.computed(this.computeTextureUrl(b.selectedTileWallTextureIndex)),b.selectedTiles.subscribe(function(a){var c=f.withResetValue(""),d=f.withResetValue(-1),e=f.withResetValue(-1),g=f.withResetValue(-1);a.forEach(function(a){c.add(a.tileType()),d.add(a.floorTextureIndex()),e.add(a.ceilingTextureIndex()),g.add(a.wallTextureIndex())}),b.selectedTileType(c.get()),b.selectedTileFloorTextureIndex(d.get()),b.selectedTileCeilingTextureIndex(e.get()),b.selectedTileWallTextureIndex(g.get())}),b.selectedTileType.subscribe(function(c){""!==c&&b.selectedTiles().forEach(function(d){var e={type:c},f=b.selectedLevel().href+"/tiles/"+d.y+"/"+d.x;d.tileType()!==c&&a.putResource(f,e,function(a){g(d,a)},function(){})})}),b.filteredLevelObjects=ko.computed(function(){var a=b.levelObjects(),c=b.selectedTiles(),d=[];return 0===c.length?d=a:a.forEach(function(a){var b=!1;c.forEach(function(c){c.x===a.raw.properties.tileX&&c.y===a.raw.properties.tileY&&(b=!0)}),b&&d.push(a)}),d});var c=this;b.sizeX.subscribe(function(a){b.tileRows().forEach(function(b){c.resizeColumns(b,a)})}),b.sizeY.subscribe(function(a){var d=b.tileRows();for(d=d.length>a?d.slice(0,a):d.slice(0,d.length);d.length<a;)d.push(c.createTileRow(a-d.length-1));b.tileRows(d)});var d=this.vm.projects;b.selectedLevel.subscribe(function(c){c&&(a.getResource(c.href+"/textures",function(a){b.levelTextures.removeAll(),b.levelTextureUrls.removeAll(),a.ids.forEach(function(a){b.levelTextureUrls.push(d.selected().href+"/textures/"+a+"/large/png"),b.levelTextures.push(a)})},function(){}),a.getResource(c.href+"/objects",function(c){b.levelObjects.removeAll(),c.table.forEach(function(c){var d={raw:c,hacking:{classDataString:e(c.Hacking.ClassData)},name:ko.observable("???")};a.getResource(c.links[0].href,function(a){d.name(a.properties.longName[0])}),b.levelObjects.push(d)})},function(){}),a.getResource(c.href+"/tiles",function(a){a.Table.forEach(function(a,c){a.forEach(function(a,d){var e=63-c,f=b.tileRows()[e].tileColumns()[d];g(f,a)})})},function(){}),b.sizeX(64),b.sizeY(64))})},d.prototype.computeTextureUrl=function(a){var b=this.vm.map.levelTextureUrls;return function(){var c=a(),d=b(),e="";return c>=0&&c<d.length&&(e=d[c]),e}},d.prototype.getTileClickedHandler=function(){var a=this.vm.map;return function(b,c){var d=!b.isSelected();b.isSelected(d),c.ctrlKey?d?a.selectedTiles.push(b):a.selectedTiles.remove(b):(a.selectedTiles.removeAll().forEach(function(a){a.isSelected(!1)}),d&&a.selectedTiles.push(b))}},d.prototype.createTile=function(a,b){var c={x:a,y:b,tileType:ko.observable("solid"),floorHeight:ko.observable(0),ceilingHeight:ko.observable(0),slopeHeight:ko.observable(0),northWallHeight:ko.observable(0),eastWallHeight:ko.observable(0),southWallHeight:ko.observable(0),westWallHeight:ko.observable(0),floorTextureIndex:ko.observable(-1),floorTextureRotations:ko.observable(0),ceilingTextureIndex:ko.observable(-1),ceilingTextureRotations:ko.observable(0),wallTextureIndex:ko.observable(-1),isSelected:ko.observable(!1)};return c.floorTextureUrl=ko.computed(this.computeTextureUrl(c.floorTextureIndex)),c.ceilingTextureUrl=ko.computed(this.computeTextureUrl(c.ceilingTextureIndex)),c.wallTextureUrl=ko.computed(this.computeTextureUrl(c.wallTextureIndex)),c.hasWallSouthWestToNorthEast=ko.computed(function(){var a=c.tileType();return"diagonalOpenNorthWest"===a||"diagonalOpenSouthEast"===a}),c.hasWallSouthEastToNorthWest=ko.computed(function(){var a=c.tileType();return"diagonalOpenNorthEast"===a||"diagonalOpenSouthWest"===a}),c},d.prototype.resizeColumns=function(a,b){var c=a.tileColumns,d=c();for(d=d.length>b?d.slice(0,b):d.slice(0,d.length);d.length<b;)d.push(this.createTile(d.length,a.y));c(d)},d.prototype.createTileRow=function(a){var b={y:a,tileColumns:ko.observableArray()};return this.resizeColumns(b,this.vm.map.sizeX()),b},b.exports=d},{"../../util/unifier.js":6}],9:[function(a,b,c){"use strict";function d(){this.vm=null,this.rest=null}d.prototype.postConstruct=function(){var a={available:ko.observableArray(),selected:ko.observable()};this.vm.projects=a,this.rest.getResource("/projects",function(b){a.available(b.items)},function(){})},b.exports=d},{}]},{},[5])(5)});