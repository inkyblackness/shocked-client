!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=function(a){window.setTimeout(a,0)};b.exports=d},{}],2:[function(a,b,c){"use strict";var d=a("./rest.js"),e=a("./unifier.js"),f=a("./browser/defer.js");ko.options.deferUpdates=!0;var g={mainSections:ko.observableArray(["project","map"]),selectedMainSection:ko.observable("project"),projects:{available:ko.observableArray(),selected:ko.observable()},levels:{available:ko.observableArray()},map:{selectedLevel:ko.observable(),sizeX:ko.observable(0),sizeY:ko.observable(0)},tileTypes:["","open","solid","diagonalOpenSouthEast","diagonalOpenSouthWest","diagonalOpenNorthWest","diagonalOpenNorthEast","slopeSouthToNorth","slopeWestToEast","slopeNorthToSouth","slopeEastToWest","valleySouthEastToNorthWest","valleySouthWestToNorthEast","valleyNorthWestToSouthEast","valleyNorthEastToSouthWest","ridgeNorthWestToSouthEast","ridgeNorthEastToSouthWest","ridgeSouthEastToNorthWest","ridgeSouthWestToNorthEast"],tileRows:ko.observableArray(),levelTextures:ko.observableArray(),levelTextureUrls:ko.observableArray(),textureDisplay:ko.observableArray(["Floor","Ceiling"]),selectedTextureDisplay:ko.observable("Floor"),selectedTiles:ko.observableArray(),selectedTileType:ko.observable(""),selectedTileFloorTextureIndex:ko.observable(-1),selectedTileCeilingTextureIndex:ko.observable(-1)};g.projects.selected.subscribe(function(a){a?d.getResource(a.href+"/archive/levels",function(a){g.levels.available(a.items)},function(){}):g.levels.available([])});var h=function(a){return function(){var b=a(),c=g.levelTextureUrls(),d="";return b>=0&&b<c.length&&(d=c[b]),d}};g.shouldShowFloorTexture=ko.computed(function(){return"Floor"===g.selectedTextureDisplay()}),g.shouldShowCeilingTexture=ko.computed(function(){return"Ceiling"===g.selectedTextureDisplay()}),g.selectedTileFloorTextureUrl=ko.computed(h(g.selectedTileFloorTextureIndex)),g.selectedTileCeilingTextureUrl=ko.computed(h(g.selectedTileCeilingTextureIndex)),g.selectTile=function(a,b){var c=!a.isSelected();a.isSelected(c),b.ctrlKey?c?g.selectedTiles.push(a):g.selectedTiles.remove(a):(g.selectedTiles.removeAll().forEach(function(a){a.isSelected(!1)}),c&&g.selectedTiles.push(a))},g.selectedTiles.subscribe(function(a){var b=e.withResetValue(""),c=e.withResetValue(-1),d=e.withResetValue(-1);a.forEach(function(a){b.add(a.tileType()),c.add(a.floorTextureIndex()),d.add(a.ceilingTextureIndex())}),g.selectedTileType(b.get()),g.selectedTileFloorTextureIndex(c.get()),g.selectedTileCeilingTextureIndex(d.get())});var i=function(a,b){a.tileType(b.properties.type),a.floorHeight(b.properties.floorHeight),a.ceilingHeight(b.properties.ceilingHeight),a.slopeHeight(b.properties.slopeHeight),a.floorTextureIndex(b.properties.realWorld.floorTexture),a.floorTextureRotations("rotations"+b.properties.realWorld.floorTextureRotations),a.ceilingTextureIndex(b.properties.realWorld.ceilingTexture),a.ceilingTextureRotations("rotations"+b.properties.realWorld.ceilingTextureRotations)};g.selectedTileType.subscribe(function(a){""!==a&&g.selectedTiles().forEach(function(b){var c={type:a},e=g.map.selectedLevel().href+"/tiles/"+b.y+"/"+b.x;b.tileType()!==a&&d.putResource(e,c,function(a){i(b,a)},function(){})})});var j=function(a,b){var c,d=g.tileRows(),e=63-b,f=null;return e>=0&&e<d.length&&(c=d[e].tileColumns(),a>=0&&a<c.length&&(f=c[a])),f},k=function(a,b){var c="solid",d=j(a,b);return null!==d&&(c=d.tileType()),c},l=function(a){return"solid"!==a&&"diagonalOpenNorthEast"!==a&&"diagonalOpenNorthWest"!==a},m=function(a){return"solid"!==a&&"diagonalOpenSouthEast"!==a&&"diagonalOpenSouthWest"!==a},n=function(a){return"solid"!==a&&"diagonalOpenSouthWest"!==a&&"diagonalOpenNorthWest"!==a},o=function(a){return"solid"!==a&&"diagonalOpenSouthEast"!==a&&"diagonalOpenNorthEast"!==a},p=function(a,b){var c={x:a,y:b,tileType:ko.observable("solid"),floorHeight:ko.observable(0),ceilingHeight:ko.observable(0),slopeHeight:ko.observable(0),floorTextureIndex:ko.observable(-1),floorTextureRotations:ko.observable("rotations0"),ceilingTextureIndex:ko.observable(-1),ceilingTextureRotations:ko.observable("rotations0"),isSelected:ko.observable(!1)};return c.floorTextureUrl=ko.computed(h(c.floorTextureIndex)),c.ceilingTextureUrl=ko.computed(h(c.ceilingTextureIndex)),c.hasWallSouthWestToNorthEast=ko.computed(function(){var a=c.tileType();return"diagonalOpenNorthWest"===a||"diagonalOpenSouthEast"===a}),c.hasWallSouthEastToNorthWest=ko.computed(function(){var a=c.tileType();return"diagonalOpenNorthEast"===a||"diagonalOpenSouthWest"===a}),c.hasWallNorth=ko.computed(function(){return m(c.tileType())&&!l(k(a,b+1))}),c.hasWallSouth=ko.computed(function(){return l(c.tileType())&&!m(k(a,b-1))}),c.hasWallEast=ko.computed(function(){return n(c.tileType())&&!o(k(a+1,b))}),c.hasWallWest=ko.computed(function(){return o(c.tileType())&&!n(k(a-1,b))}),c},q=function(a,b){for(var c=a.tileColumns;c().length>b;)c.pop();for(;c().length<b;)c().push(p(c().length,a.y))};g.map.sizeX.subscribe(function(a){g.tileRows().forEach(function(b){q(b,a)})});var r=function(a){var b={y:a,tileColumns:ko.observableArray()};return q(b,g.map.sizeX()),b};g.map.sizeY.subscribe(function(a){for(;g.tileRows().length>a;)g.tileRows.pop();for(;g.tileRows().length<a;)g.tileRows.push(r(a-g.tileRows().length-1))}),g.map.selectedLevel.subscribe(function(a){a&&(d.getResource(a.href+"/textures",function(a){g.levelTextures.removeAll(),g.levelTextureUrls.removeAll(),a.ids.forEach(function(a){g.levelTextureUrls.push(g.projects.selected().href+"/textures/"+a+"/large/png"),g.levelTextures.push(a)})},function(){}),d.getResource(a.href+"/tiles",function(a){a.Table.forEach(function(a,b){a.forEach(function(a,c){f(function(){var d=63-b,e=g.tileRows()[d].tileColumns()[c];i(e,a)})})})},function(){}),g.map.sizeX(64),g.map.sizeY(64))}),ko.applyBindings(g),d.getResource("/projects",function(a){g.projects.available(a.items)},function(){})},{"./browser/defer.js":1,"./rest.js":3,"./unifier.js":4}],3:[function(a,b,c){"use strict";var d={};d.getResource=function(a,b,c){var d={method:"GET",url:a,dataType:"json",jsonp:!1,success:b,error:c};$.ajax(d)},d.putResource=function(a,b,c,d){var e={method:"PUT",url:a,dataType:"json",contentType:"application/json",data:JSON.stringify(b),jsonp:!1,processData:!1,success:c,error:d};$.ajax(e)},b.exports=d},{}],4:[function(a,b,c){"use strict";var d={};d.withResetValue=function(a){var b=!0,c=a,d={add:function(d){b?(c=d,b=!1):c!==d&&(c=a)},get:function(){return c}};return d},b.exports=d},{}]},{},[2]);