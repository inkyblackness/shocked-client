!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=a("./rest.js");ko.options.deferUpdates=!0;var e={mainSections:ko.observableArray(["project","map"]),selectedMainSection:ko.observable("project"),projects:{available:ko.observableArray(),selected:ko.observable()},levels:{available:ko.observableArray()},map:{selectedLevel:ko.observable()},tileTypes:["","open","solid","diagonalOpenSouthEast","diagonalOpenSouthWest","diagonalOpenNorthWest","diagonalOpenNorthEast","slopeSouthToNorth","slopeWestToEast","slopeNorthToSouth","slopeEastToWest","valleySouthEastToNorthWest","valleySouthWestToNorthEast","valleyNorthWestToSouthEast","valleyNorthEastToSouthWest","ridgeNorthWestToSouthEast","ridgeNorthEastToSouthWest","ridgeSouthEastToNorthWest","ridgeSouthWestToNorthEast"],mapWidth:ko.observable(0),mapHeight:ko.observable(0),tileRows:ko.observableArray(),levelTextures:ko.observableArray(),levelTextureUrls:ko.observableArray(),textureDisplay:ko.observableArray(["Floor","Ceiling"]),selectedTextureDisplay:ko.observable("Floor"),selectedTiles:ko.observableArray(),selectedTileType:ko.observable(""),selectedTileFloorTextureIndex:ko.observable(-1),selectedTileCeilingTextureIndex:ko.observable(-1)};e.projects.selected.subscribe(function(a){a?d.getResource(a.href+"/archive/levels",function(a){e.levels.available(a.items)},function(){}):e.levels.available([])});var f=function(a){return function(){var b=a(),c=e.levelTextureUrls(),d="";return b>=0&&b<c.length&&(d=c[b]),d}};e.shouldShowFloorTexture=ko.computed(function(){return"Floor"===e.selectedTextureDisplay()}),e.shouldShowCeilingTexture=ko.computed(function(){return"Ceiling"===e.selectedTextureDisplay()}),e.selectedTileFloorTextureUrl=ko.computed(f(e.selectedTileFloorTextureIndex)),e.selectedTileCeilingTextureUrl=ko.computed(f(e.selectedTileCeilingTextureIndex)),e.selectTile=function(a,b){var c=!a.isSelected();a.isSelected(c),b.ctrlKey?c?e.selectedTiles.push(a):e.selectedTiles.remove(a):(e.selectedTiles.removeAll().forEach(function(a){a.isSelected(!1)}),c&&e.selectedTiles.push(a))};var g=function(a){var b=!0,c=!0,d=a,e={add:function(e){b?(d=e,b=!1):d!==e&&(c=!1,d=a)},get:function(){return d}};return e};e.selectedTiles.subscribe(function(a){var b=g(""),c=g(-1),d=g(-1);a.forEach(function(a){b.add(a.tileType()),c.add(a.floorTextureIndex()),d.add(a.ceilingTextureIndex())}),e.selectedTileType(b.get()),e.selectedTileFloorTextureIndex(c.get()),e.selectedTileCeilingTextureIndex(d.get())});var h=function(a,b){a.tileType(b.properties.type),a.floorHeight(b.properties.floorHeight),a.ceilingHeight(b.properties.ceilingHeight),a.slopeHeight(b.properties.slopeHeight),a.floorTextureIndex(b.properties.realWorld.floorTexture),a.floorTextureRotations("rotations"+b.properties.realWorld.floorTextureRotations),a.ceilingTextureIndex(b.properties.realWorld.ceilingTexture),a.ceilingTextureRotations("rotations"+b.properties.realWorld.ceilingTextureRotations)};e.selectedTileType.subscribe(function(a){""!==a&&e.selectedTiles().forEach(function(b){var c={type:a},f=e.map.selectedLevel().href+"/tiles/"+b.y+"/"+b.x;b.tileType()!==a&&d.putResource(f,c,function(a){h(b,a)},function(){})})});var i=function(a,b){var c,d=e.tileRows(),f=63-b,g=null;return f>=0&&f<d.length&&(c=d[f].tileColumns(),a>=0&&a<c.length&&(g=c[a])),g},j=function(a,b){var c="solid",d=i(a,b);return null!==d&&(c=d.tileType()),c},k=function(a){return"solid"!==a&&"diagonalOpenNorthEast"!==a&&"diagonalOpenNorthWest"!==a},l=function(a){return"solid"!==a&&"diagonalOpenSouthEast"!==a&&"diagonalOpenSouthWest"!==a},m=function(a){return"solid"!==a&&"diagonalOpenSouthWest"!==a&&"diagonalOpenNorthWest"!==a},n=function(a){return"solid"!==a&&"diagonalOpenSouthEast"!==a&&"diagonalOpenNorthEast"!==a},o=function(a,b){var c={x:a,y:b,tileType:ko.observable("solid"),floorHeight:ko.observable(0),ceilingHeight:ko.observable(0),slopeHeight:ko.observable(0),floorTextureIndex:ko.observable(-1),floorTextureRotations:ko.observable("rotations0"),ceilingTextureIndex:ko.observable(-1),ceilingTextureRotations:ko.observable("rotations0"),isSelected:ko.observable(!1)};return c.floorTextureUrl=ko.computed(f(c.floorTextureIndex)),c.ceilingTextureUrl=ko.computed(f(c.ceilingTextureIndex)),c.hasWallSouthWestToNorthEast=ko.computed(function(){var a=c.tileType();return"diagonalOpenNorthWest"===a||"diagonalOpenSouthEast"===a}),c.hasWallSouthEastToNorthWest=ko.computed(function(){var a=c.tileType();return"diagonalOpenNorthEast"===a||"diagonalOpenSouthWest"===a}),c.hasWallNorth=ko.computed(function(){return l(c.tileType())&&!k(j(a,b+1))}),c.hasWallSouth=ko.computed(function(){return k(c.tileType())&&!l(j(a,b-1))}),c.hasWallEast=ko.computed(function(){return m(c.tileType())&&!n(j(a+1,b))}),c.hasWallWest=ko.computed(function(){return n(c.tileType())&&!m(j(a-1,b))}),c},p=function(a,b){for(var c=a.tileColumns;c().length>b;)c.pop();for(;c().length<b;)c().push(o(c().length,a.y))};e.mapWidth.subscribe(function(a){e.tileRows().forEach(function(b){p(b,a)})});var q=function(a){var b={y:a,tileColumns:ko.observableArray()};return p(b,e.mapWidth()),b};e.mapHeight.subscribe(function(a){for(;e.tileRows().length>a;)e.tileRows.pop();for(;e.tileRows().length<a;)e.tileRows.push(q(a-e.tileRows().length-1))}),e.map.selectedLevel.subscribe(function(a){a&&(d.getResource(a.href+"/textures",function(a){e.levelTextures.removeAll(),e.levelTextureUrls.removeAll(),a.ids.forEach(function(a){e.levelTextureUrls.push(e.projects.selected().href+"/textures/"+a+"/large/png"),e.levelTextures.push(a)})},function(){}),d.getResource(a.href+"/tiles",function(a){a.Table.forEach(function(a,b){a.forEach(function(a,c){window.setTimeout(function(){var d=63-b,f=e.tileRows()[d].tileColumns()[c];h(f,a)},0)})})},function(){}),e.mapWidth(64),e.mapHeight(64))}),ko.applyBindings(e),d.getResource("/projects",function(a){e.projects.available(a.items)},function(){})},{"./rest.js":2}],2:[function(a,b,c){"use strict";var d={};d.getResource=function(a,b,c){var d={method:"GET",url:a,dataType:"json",jsonp:!1,success:b,error:c};$.ajax(d)},d.putResource=function(a,b,c,d){var e={method:"PUT",url:a,dataType:"json",contentType:"application/json",data:JSON.stringify(b),jsonp:!1,processData:!1,success:c,error:d};$.ajax(e)},b.exports=d},{}]},{},[1]);