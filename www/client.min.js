!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){!function(a){"use strict";function d(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1}a.version="1.0.0";var e=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,f=/,/,g=/^\s*(_?)(\S+?)\1\s*$/,h=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;a.errors={MAPPING_BAD_PROP:"[Error infuse.Injector.mapClass/mapValue] the first parameter is invalid, a string is expected",MAPPING_BAD_VALUE:"[Error infuse.Injector.mapClass/mapValue] the second parameter is invalid, it can't null or undefined, with property: ",MAPPING_BAD_CLASS:"[Error infuse.Injector.mapClass/mapValue] the second parameter is invalid, a function is expected, with property: ",MAPPING_BAD_SINGLETON:"[Error infuse.Injector.mapClass] the third parameter is invalid, a boolean is expected, with property: ",MAPPING_ALREADY_EXISTS:"[Error infuse.Injector.mapClass/mapValue] this mapping already exists, with property: ",CREATE_INSTANCE_INVALID_PARAM:"[Error infuse.Injector.createInstance] invalid parameter, a function is expected",NO_MAPPING_FOUND:"[Error infuse.Injector.getInstance] no mapping found",INJECT_INSTANCE_IN_ITSELF_PROPERTY:"[Error infuse.Injector.getInjectedValue] A matching property has been found in the target, you can't inject an instance in itself",INJECT_INSTANCE_IN_ITSELF_CONSTRUCTOR:"[Error infuse.Injector.getInjectedValue] A matching constructor parameter has been found in the target, you can't inject an instance in itself",DEPENDENCIES_MISSING_IN_STRICT_MODE:'[Error infuse.Injector.getDependencies] An "inject" property (array) that describes the dependencies is missing in strict mode.'};var i=function(a,b,c,d){this.prop=a,this.value=b,this.cl=c,this.singleton=d||!1},j=function(b){if("string"!=typeof b)throw new Error(a.errors.MAPPING_BAD_PROP)},k=function(b,c){if(void 0===c||null===c)throw new Error(a.errors.MAPPING_BAD_VALUE+b)},l=function(b,c){if("function"!=typeof c)throw new Error(a.errors.MAPPING_BAD_CLASS+b)},m=function(b,c){if("boolean"!=typeof c)throw new Error(a.errors.MAPPING_BAD_SINGLETON+b)},n=function(b,c){var e=a.getDependencies(c);if(d(e,b))throw new Error(a.errors.INJECT_INSTANCE_IN_ITSELF_CONSTRUCTOR)},o=function(b,c){if(c.hasOwnProperty(b))throw new Error(a.errors.INJECT_INSTANCE_IN_ITSELF_PROPERTY)};a.Injector=function(){this.mappings={},this.parent=null,this.strictMode=!1},a.getDependencies=function(a){function b(a,b,c){d.push(c)}var c,d=[];a.hasOwnProperty("inject")&&"[object Array]"===Object.prototype.toString.call(a.inject)&&a.inject.length>0&&(c=a.inject);for(var i=a.toString().replace(h,""),j=i.match(e),k=j[1].split(f),l=0,m=k.length;m>l;l++){var n=c&&c[l]?c[l]:k[l];n.replace(g,b)}return d},a.Injector.prototype={createChild:function(){var b=new a.Injector;return b.parent=this,b.strictMode=this.strictMode,b},getMappingVo:function(a){return this.mappings?this.mappings[a]?this.mappings[a]:this.parent?this.parent.getMappingVo(a):null:null},mapValue:function(b,c){if(this.mappings[b])throw new Error(a.errors.MAPPING_ALREADY_EXISTS+b);return j(b),k(b,c),this.mappings[b]=new i(b,c,void 0,void 0),this},mapClass:function(b,c,d){if(this.mappings[b])throw new Error(a.errors.MAPPING_ALREADY_EXISTS+b);return j(b),l(b,c),d&&m(b,d),this.mappings[b]=new i(b,null,c,d),this},removeMapping:function(a){return this.mappings[a]=null,delete this.mappings[a],this},hasMapping:function(a){return!!this.mappings[a]},hasInheritedMapping:function(a){return!!this.getMappingVo(a)},getMapping:function(a){for(var b in this.mappings)if(this.mappings.hasOwnProperty(b)){var c=this.mappings[b];if(c.value===a||c.cl===a)return c.prop}},getValue:function(b){var c=this.mappings[b];if(!c){if(!this.parent)throw new Error(a.errors.NO_MAPPING_FOUND);c=this.parent.getMappingVo.apply(this.parent,arguments)}if(c.cl){var d=Array.prototype.slice.call(arguments);return d[0]=c.cl,c.singleton?(c.value||(c.value=this.createInstance.apply(this,d)),c.value):this.createInstance.apply(this,d)}return c.value},getClass:function(a){var b=this.mappings[a];if(!b){if(!this.parent)return;b=this.parent.getMappingVo.apply(this.parent,arguments)}return b.cl?b.cl:void 0},instantiate:function(b){if("function"!=typeof b)throw new Error(a.errors.CREATE_INSTANCE_INVALID_PARAM);if(this.strictMode&&!b.hasOwnProperty("inject"))throw new Error(a.errors.DEPENDENCIES_MISSING_IN_STRICT_MODE);for(var c=[null],d=a.getDependencies(b),e=0,f=d.length;f>e;e++)if(arguments.length>e+1&&void 0!==arguments[e+1]&&null!==arguments[e+1])c.push(arguments[e+1]);else{var g=d[e],h=this.getMappingVo(g);if(h){var i=this.getInjectedValue(h,g);c.push(i)}else c.push(void 0)}return new(Function.prototype.bind.apply(b,c))},inject:function(a,b){this.parent&&this.parent.inject(a,!0);for(var c in this.mappings)if(this.mappings.hasOwnProperty(c)){var d=this.getMappingVo(c);(a.hasOwnProperty(d.prop)||a.constructor&&a.constructor.prototype&&a.constructor.prototype.hasOwnProperty(d.prop))&&(a[c]=this.getInjectedValue(d,c))}return"function"!=typeof a.postConstruct||b||a.postConstruct(),this},getInjectedValue:function(a,b){var c,d=a.value;return a.cl&&(a.singleton?(a.value||(n(b,a.cl),a.value=this.instantiate(a.cl),c=a.value),d=a.value):(n(b,a.cl),d=this.instantiate(a.cl),c=d)),c&&(o(b,c),this.inject(c)),d},createInstance:function(){var a=this.instantiate.apply(this,arguments);return this.inject(a),a},getValueFromClass:function(b){for(var c in this.mappings)if(this.mappings.hasOwnProperty(c)){var d=this.mappings[c];if(d.cl===b)return d.singleton?(d.value||(d.value=this.createInstance.apply(this,arguments)),d.value):this.createInstance.apply(this,arguments)}if(this.parent)return this.parent.getValueFromClass.apply(this.parent,arguments);throw new Error(a.errors.NO_MAPPING_FOUND)},dispose:function(){this.mappings={}}},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new Error("Error, you must bind a function.");var c=Array.prototype.slice.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(Array.prototype.slice.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(Array.prototype.slice.call(arguments)))};return d}),"function"==typeof define&&"undefined"!=typeof define.amd&&define("infuse",a),"undefined"!=typeof b&&"undefined"!=typeof b.exports&&(b.exports=a),"undefined"!=typeof c&&(c=a)}(this.infuse=this.infuse||{})},{}],2:[function(a,b,c){"use strict";var d=function(a){window.setTimeout(a,0)};b.exports=d},{}],3:[function(a,b,c){"use strict";var d={};d.getResource=function(a,b,c){var d={method:"GET",url:a,dataType:"json",jsonp:!1,success:b,error:c};$.ajax(d)},d.putResource=function(a,b,c,d){var e={method:"PUT",url:a,dataType:"json",contentType:"application/json",data:JSON.stringify(b),jsonp:!1,processData:!1,success:c,error:d};$.ajax(e)},b.exports=d},{}],4:[function(a,b,c){"use strict";var d=(a("./util/unifier.js"),a("./browser/rest.js")),e=a("./browser/defer.js"),f=a("infuse.js"),g=new f.Injector;ko.options.deferUpdates=!0;var h={mainSections:ko.observableArray(["project","map"]),selectedMainSection:ko.observable("project")};g.mapValue("rest",d),g.mapValue("sys",{defer:e}),g.mapValue("vm",h);var i=a("./vmAdapter/ProjectsAdapter");g.mapClass("projectsAdapter",i,!0);var j=a("./vmAdapter/LevelsAdapter");g.mapClass("levelsAdapter",j,!0);var k=a("./vmAdapter/MapAdapter");g.mapClass("mapAdapter",k,!0);g.getValue("projectsAdapter"),g.getValue("levelsAdapter"),g.getValue("mapAdapter");ko.applyBindings(h)},{"./browser/defer.js":2,"./browser/rest.js":3,"./util/unifier.js":5,"./vmAdapter/LevelsAdapter":6,"./vmAdapter/MapAdapter":7,"./vmAdapter/ProjectsAdapter":8,"infuse.js":1}],5:[function(a,b,c){"use strict";var d={};d.withResetValue=function(a){var b=!0,c=a,d={add:function(d){b?(c=d,b=!1):c!==d&&(c=a)},get:function(){return c}};return d},b.exports=d},{}],6:[function(a,b,c){"use strict";function d(){this.projectsAdapter=null,this.vm=null,this.rest=null}d.prototype.postConstruct=function(){var a=this.rest,b={available:ko.observableArray()};this.vm.levels=b,this.vm.projects.selected.subscribe(function(c){c?a.getResource(c.href+"/archive/levels",function(a){b.available(a.items)},function(){}):b.available([])})},b.exports=d},{}],7:[function(a,b,c){"use strict";function d(){this.projectsAdapter=null,this.vm=null,this.rest=null,this.sys=null}var e=a("../../util/unifier.js"),f=function(a,b){a.tileType(b.properties.type),a.floorHeight(b.properties.floorHeight),a.ceilingHeight(b.properties.ceilingHeight),a.slopeHeight(b.properties.slopeHeight),a.floorTextureIndex(b.properties.realWorld.floorTexture),a.floorTextureRotations("rotations"+b.properties.realWorld.floorTextureRotations),a.ceilingTextureIndex(b.properties.realWorld.ceilingTexture),a.ceilingTextureRotations("rotations"+b.properties.realWorld.ceilingTextureRotations)},g=function(a){return"solid"!==a&&"diagonalOpenNorthEast"!==a&&"diagonalOpenNorthWest"!==a},h=function(a){return"solid"!==a&&"diagonalOpenSouthEast"!==a&&"diagonalOpenSouthWest"!==a},i=function(a){return"solid"!==a&&"diagonalOpenSouthWest"!==a&&"diagonalOpenNorthWest"!==a},j=function(a){return"solid"!==a&&"diagonalOpenSouthEast"!==a&&"diagonalOpenNorthEast"!==a};d.prototype.postConstruct=function(){var a=this.rest,b={tileTypes:["","open","solid","diagonalOpenSouthEast","diagonalOpenSouthWest","diagonalOpenNorthWest","diagonalOpenNorthEast","slopeSouthToNorth","slopeWestToEast","slopeNorthToSouth","slopeEastToWest","valleySouthEastToNorthWest","valleySouthWestToNorthEast","valleyNorthWestToSouthEast","valleyNorthEastToSouthWest","ridgeNorthWestToSouthEast","ridgeNorthEastToSouthWest","ridgeSouthEastToNorthWest","ridgeSouthWestToNorthEast"],selectedLevel:ko.observable(),levelTextures:ko.observableArray(),levelTextureUrls:ko.observableArray(),sizeX:ko.observable(0),sizeY:ko.observable(0),tileRows:ko.observableArray(),textureDisplay:ko.observableArray(["Floor","Ceiling"]),selectedTextureDisplay:ko.observable("Floor"),selectedTiles:ko.observableArray(),selectedTileType:ko.observable(""),selectedTileFloorTextureIndex:ko.observable(-1),selectedTileCeilingTextureIndex:ko.observable(-1)};this.vm.map=b,b.onTileClicked=this.getTileClickedHandler(),b.shouldShowFloorTexture=ko.computed(function(){return"Floor"===b.selectedTextureDisplay()}),b.shouldShowCeilingTexture=ko.computed(function(){return"Ceiling"===b.selectedTextureDisplay()}),b.selectedTileFloorTextureUrl=ko.computed(this.computeTextureUrl(b.selectedTileFloorTextureIndex)),b.selectedTileCeilingTextureUrl=ko.computed(this.computeTextureUrl(b.selectedTileCeilingTextureIndex)),b.selectedTiles.subscribe(function(a){var c=e.withResetValue(""),d=e.withResetValue(-1),f=e.withResetValue(-1);a.forEach(function(a){c.add(a.tileType()),d.add(a.floorTextureIndex()),f.add(a.ceilingTextureIndex())}),b.selectedTileType(c.get()),b.selectedTileFloorTextureIndex(d.get()),b.selectedTileCeilingTextureIndex(f.get())}),b.selectedTileType.subscribe(function(c){""!==c&&b.selectedTiles().forEach(function(d){var e={type:c},g=b.selectedLevel().href+"/tiles/"+d.y+"/"+d.x;d.tileType()!==c&&a.putResource(g,e,function(a){f(d,a)},function(){})})});var c=this;b.sizeX.subscribe(function(a){b.tileRows().forEach(function(b){c.resizeColumns(b,a)})}),b.sizeY.subscribe(function(a){for(;b.tileRows().length>a;)b.tileRows.pop();for(;b.tileRows().length<a;)b.tileRows.push(c.createTileRow(a-b.tileRows().length-1))});var d=this.vm.projects;b.selectedLevel.subscribe(function(e){e&&(a.getResource(e.href+"/textures",function(a){b.levelTextures.removeAll(),b.levelTextureUrls.removeAll(),a.ids.forEach(function(a){b.levelTextureUrls.push(d.selected().href+"/textures/"+a+"/large/png"),b.levelTextures.push(a)})},function(){}),a.getResource(e.href+"/tiles",function(a){a.Table.forEach(function(a,d){a.forEach(function(a,e){c.sys.defer(function(){var c=63-d,g=b.tileRows()[c].tileColumns()[e];f(g,a)})})})},function(){}),b.sizeX(64),b.sizeY(64))})},d.prototype.computeTextureUrl=function(a){var b=this.vm.map.levelTextureUrls;return function(){var c=a(),d=b(),e="";return c>=0&&c<d.length&&(e=d[c]),e}},d.prototype.getTileClickedHandler=function(){var a=this.vm.map;return function(b,c){var d=!b.isSelected();b.isSelected(d),c.ctrlKey?d?a.selectedTiles.push(b):a.selectedTiles.remove(b):(a.selectedTiles.removeAll().forEach(function(a){a.isSelected(!1)}),d&&a.selectedTiles.push(b))}},d.prototype.getTile=function(a,b){var c,d=this.vm.map.tileRows(),e=63-b,f=null;return e>=0&&e<d.length&&(c=d[e].tileColumns(),a>=0&&a<c.length&&(f=c[a])),f},d.prototype.getTileType=function(a,b){var c="solid",d=this.getTile(a,b);return null!==d&&(c=d.tileType()),c},d.prototype.createTile=function(a,b){var c=this,d=function(a,b){return c.getTileType(a,b)},e={x:a,y:b,tileType:ko.observable("solid"),floorHeight:ko.observable(0),ceilingHeight:ko.observable(0),slopeHeight:ko.observable(0),floorTextureIndex:ko.observable(-1),floorTextureRotations:ko.observable("rotations0"),ceilingTextureIndex:ko.observable(-1),ceilingTextureRotations:ko.observable("rotations0"),isSelected:ko.observable(!1)};return e.floorTextureUrl=ko.computed(this.computeTextureUrl(e.floorTextureIndex)),e.ceilingTextureUrl=ko.computed(this.computeTextureUrl(e.ceilingTextureIndex)),e.hasWallSouthWestToNorthEast=ko.computed(function(){var a=e.tileType();return"diagonalOpenNorthWest"===a||"diagonalOpenSouthEast"===a}),e.hasWallSouthEastToNorthWest=ko.computed(function(){var a=e.tileType();return"diagonalOpenNorthEast"===a||"diagonalOpenSouthWest"===a}),e.hasWallNorth=ko.computed(function(){return h(e.tileType())&&!g(d(a,b+1))}),e.hasWallSouth=ko.computed(function(){return g(e.tileType())&&!h(d(a,b-1))}),e.hasWallEast=ko.computed(function(){return i(e.tileType())&&!j(d(a+1,b))}),e.hasWallWest=ko.computed(function(){return j(e.tileType())&&!i(d(a-1,b))}),e},d.prototype.resizeColumns=function(a,b){for(var c=a.tileColumns;c().length>b;)c.pop();for(;c().length<b;)c().push(this.createTile(c().length,a.y))},d.prototype.createTileRow=function(a){var b={y:a,tileColumns:ko.observableArray()};return this.resizeColumns(b,this.vm.map.sizeX()),b},b.exports=d},{"../../util/unifier.js":5}],8:[function(a,b,c){"use strict";function d(){this.vm=null,this.rest=null}d.prototype.postConstruct=function(){var a={available:ko.observableArray(),selected:ko.observable()};this.vm.projects=a,this.rest.getResource("/projects",function(b){a.available(b.items)},function(){})},b.exports=d},{}]},{},[4]);